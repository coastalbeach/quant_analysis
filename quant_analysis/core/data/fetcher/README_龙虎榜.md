# 龙虎榜数据模块

## 模块概述

本模块基于东方财富网的龙虎榜数据，实现了数据获取、存储和分析功能。龙虎榜数据是市场交易中的重要信息，可以反映机构和大资金的交易行为，对量化分析和投资决策有重要参考价值。

## 模块结构

龙虎榜数据模块包含以下三个主要部分：

1. **数据获取与存储模块** (`daily/lhb.py`)：负责从东方财富网获取各类龙虎榜数据，并将数据存入数据库。

2. **数据分析模块** (`analyst/lhb_analyst.py`)：基于存储的龙虎榜数据，提供各种分析功能，如热门股票分析、机构买卖行为分析等。

3. **统一接口模块** (`lhb.py`)：整合数据获取和分析功能，提供统一的对外接口。

## 数据分类与存储策略

根据数据特性，我们将龙虎榜数据分为两类：

1. **历史数据类**：适合存入数据库的数据，如龙虎榜详情、机构买卖每日统计等。这类数据具有历史价值，需要长期保存和查询。

2. **实时查询类**：适合封装为功能随用随调的数据，如个股龙虎榜详情。这类数据通常是针对特定股票和日期的查询，不需要全量存储。

## 主要功能

### 数据获取与存储

- 龙虎榜详情数据获取与存储
- 个股上榜统计数据获取与存储
- 机构买卖每日统计数据获取与存储
- 机构席位追踪数据获取与存储
- 每日活跃营业部数据获取与存储
- 营业部排行数据获取与存储
- 营业部统计数据获取与存储

### 数据分析

- 热门股票分析：分析最近一段时间内多次上榜的股票
- 机构买卖行为分析：分析机构买入和卖出最多的股票
- 活跃营业部分析：分析最活跃的营业部及其交易特点
- 个股上榜后表现分析：分析个股上榜后的涨跌幅表现
- 龙虎榜选股策略：基于龙虎榜数据的选股策略

## 使用示例

### 更新龙虎榜数据

```python
from core.data.fetcher.lhb import update_lhb_data

# 更新昨天的龙虎榜数据
update_lhb_data()

# 更新指定日期范围的龙虎榜数据
update_lhb_data(start_date="20240401", end_date="20240430")
```

### 分析龙虎榜数据

```python
from core.data.fetcher.lhb import get_lhb_data

# 获取龙虎榜数据摘要
summary = get_lhb_data("summary", days=30)

# 获取热门上榜股票
hot_stocks = get_lhb_data("hot_stocks", days=30, min_count=2)

# 获取机构买卖行为分析
inst_behavior = get_lhb_data("institution_behavior", days=30, top_n=20)

# 获取龙虎榜选股结果
stock_selection = get_lhb_data("stock_selection", days=30, min_count=2, min_inst_buy=1000000)

# 获取个股龙虎榜详情
stock_detail = get_lhb_data("stock_detail", symbol="600077", date="20240401", flag="买入")
```

## 数据表结构

### 龙虎榜详情表

主键：`['代码', '上榜日']`

字段包括：序号、代码、名称、上榜日、解读、收盘价、涨跌幅、龙虎榜净买额、龙虎榜买入额、龙虎榜卖出额、龙虎榜成交额、市场总成交额、净买额占总成交比、成交额占总成交比、换手率、流通市值、上榜原因、上榜后1日、上榜后2日、上榜后5日、上榜后10日

### 个股上榜统计表

主键：`['代码']`

字段包括：序号、代码、名称、最近上榜日、收盘价、涨跌幅、上榜次数、龙虎榜净买额、龙虎榜买入额、龙虎榜卖出额、龙虎榜总成交额、买方机构次数、卖方机构次数、机构买入净额、机构买入总额、机构卖出总额、近1个月涨跌幅、近3个月涨跌幅、近6个月涨跌幅、近1年涨跌幅

### 机构买卖每日统计表

主键：`['代码', '上榜日期']`

字段包括：序号、代码、名称、收盘价、涨跌幅、买方机构数、卖方机构数、机构买入总额、机构卖出总额、机构买入净额、市场总成交额、机构净买额占总成交额比、换手率、流通市值、上榜原因、上榜日期

### 每日活跃营业部表

主键：`['营业部名称', '上榜日']`

字段包括：序号、营业部名称、上榜日、买入个股数、卖出个股数、买入总金额、卖出总金额、总买卖净额、买入股票

## 定时更新建议

建议设置以下定时任务：

1. 每日收盘后更新当日龙虎榜数据：
   ```python
   update_lhb_data()
   ```

2. 每周一次更新统计类数据：
   ```python
   # 更新所有统计类数据
   update_lhb_data(update_all=True)
   ```

## 注意事项

1. 龙虎榜数据通常在交易日收盘后更新，建议在收盘后半小时至一小时后获取数据。
2. 部分接口（如个股龙虎榜详情）需要提供特定的日期参数，这些日期必须是该股票上榜的日期，否则可能无法获取数据。
3. 统计类数据（如个股上榜统计、机构席位追踪等）每次获取都是完整替换，不进行增量更新。